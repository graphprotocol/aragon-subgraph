specVersion: 0.0.2
schema:
  file: ./schema.graphql
dataSources:
  - name: APM
    kind: ethereum/contract
    network: mainnet
    source:
      abi: APMRegistryFactory
      address: '0xce5c6811bd801aa0cf72760534604f833cbcc0b9'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/apm.ts
      abis:
        - name: APMRegistryFactory
          file: ./abis/factory/APMRegistryFactory.json
      entities:
        - PackageRegistry
      eventHandlers:
        - event: DeployAPM(indexed bytes32,address)
          handler: handleDeployAPM

  - name: ENS
    kind: ethereum/contract
    network: mainnet
    source:
      abi: FIFSResolvingRegistrar
      address: '0x546aa2eae2514494eeadb7bbb35243348983c59d'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/ens.ts
      entities:
        - ENSResolver
      abis:
        - name: FIFSResolvingRegistrar
          file: ./abis/ens/FIFSResolvingRegistrar.json
      eventHandlers:
        - event: ClaimSubdomain(indexed bytes32,indexed address,indexed address)
          handler: handleClaimSubdomain

  - name: DAO
    kind: ethereum/contract
    network: mainnet
    source:
      abi: AuxiliaryContract
      address: '0x7f751820be4b1e44464268c425af6095995e045a'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/dao.ts
      entities:
        - Organization
      abis:
        - name: AuxiliaryContract
          file: ./abis/AuxiliaryContract.json
      eventHandlers:
        - event: 'Unknown(indexed bytes,indexed bytes)'
          topic0: '0xa9e319c3b10db96c5cee4bc3ebffa9c5581f222f14a4deb0df7ec2088ccd0974'
          handler: registerDAOFactories

  #
  # Templates
  #

  # democracy-kit-2.x
  - name: DemocracyKit
    kind: ethereum/contract
    network: mainnet
    source:
      abi: DemocracyKit
      address: '0x7f3ed10366826a1227025445D4f4e3e14BBfc91d'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/dao-templates.ts
      entities:
        - Organization
      abis:
        - name: DemocracyKit
          file: ./abis/kits/DemocracyKit.json
      eventHandlers:
        - event: DeployInstance(address,indexed address)
          handler: handleDeployDemocracyDao

  # multisig-kit-2.x
  - name: MultisigKit
    kind: ethereum/contract
    network: mainnet
    source:
      abi: MultisigKit
      address: '0x87aa2980dde7d2D4e57191f16BB57cF80bf6E5A6'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/dao-templates.ts
      entities:
        - Organization
      abis:
        - name: MultisigKit
          file: ./abis/kits/MultisigKit.json
      eventHandlers:
        - event: DeployInstance(address,indexed address)
          handler: handleDeployMultisigDao

  # company-template-1.x
  - name: CompanyTemplate
    kind: ethereum/contract
    network: mainnet
    source:
      abi: BaseTemplate
      address: '0xd737632caC4d039C9B0EEcc94C12267407a271b5'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/dao-templates.ts
      entities:
        - Organization
      abis:
        - name: BaseTemplate
          file: ./abis/templates/BaseTemplate.json
      eventHandlers:
        - event: DeployDao(address)
          handler: handleDeployCompanyDao

  # company-board-template-1.x
  - name: CompanyBoardTemplate
    kind: ethereum/contract
    network: mainnet
    source:
      abi: BaseTemplate
      address: '0x4d1A892f42c947fa952b57bc6939b27A96215CfA'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/dao-templates.ts
      entities:
        - Organization
      abis:
        - name: BaseTemplate
          file: ./abis/templates/BaseTemplate.json
      eventHandlers:
        - event: DeployDao(address)
          handler: handleDeployCompanyBoardDao

  # membership-template-2.x
  - name: MembershipTemplate
    kind: ethereum/contract
    network: mainnet
    source:
      abi: BaseTemplate
      address: '0x67430642C0c3B5E6538049B9E9eE719f2a4BeE7c'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/dao-templates.ts
      entities:
        - Organization
      abis:
        - name: BaseTemplate
          file: ./abis/templates/BaseTemplate.json
      eventHandlers:
        - event: DeployDao(address)
          handler: handleDeployMembershipDao

  # reputation-template-1.x
  - name: ReputationTemplate
    kind: ethereum/contract
    network: mainnet
    source:
      abi: BaseTemplate
      address: '0x3a06A6544e48708142508D9042f94DDdA769d04F'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/dao-templates.ts
      entities:
        - Organization
      abis:
        - name: BaseTemplate
          file: ./abis/templates/BaseTemplate.json
      eventHandlers:
        - event: DeployDao(address)
          handler: handleDeployReputationpDao

  #
  # Apps
  #

  # Token Manager 2.x
  - name: token-manager-2.x
    kind: ethereum/contract
    network: mainnet
    source:
      abi: TokenManager
      address: '0xde3a93028f2283cc28756b3674bd657eafb992f4'
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/apps/token-manager.ts
      entities:
        - Vesting
      abis:
        - name: TokenManager
          file: ./abis/apps/TokenManager.json
      eventHandlers:
        - event: NewVesting(indexed address,uint256,uint256)
          handler: handleNewVesting
        - event: RevokeVesting(indexed address,uint256,uint256)
          handler: handleRevokeVesting
        - event: ScriptResult(indexed address,bytes,bytes,bytes)
          handler: handleScriptResult
        - event: RecoverToVault(indexed address,indexed address,uint256)
          handler: handleRecoverToVault

templates:
  - name: ACL
    kind: ethereum/contract
    network: mainnet
    source:
      abi: ACL
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/acl.ts
      abis:
        - name: ACL
          file: ./abis/acl/ACL.json
      entities:
        - Permission
      eventHandlers:
        - event: SetPermission(indexed address,indexed address,indexed bytes32,bool)
          handler: handleSetPermission
        - event: SetPermissionParams(indexed address,indexed address,indexed bytes32,bytes32)
          handler: handleSetPermissionParams
        - event: ChangePermissionManager(indexed address,indexed bytes32,indexed address)
          handler: handleChangePermissionManager
  - name: APMRegistry
    kind: ethereum/contract
    network: mainnet
    source:
      abi: APMRegistry
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/apm.ts
      entities:
        - Package
      abis:
        - name: APMRegistry
          file: ./abis/apm/APMRegistry.json
      eventHandlers:
        - event: NewRepo(bytes32,string,address)
          handler: handleNewRepo
  - name: DAOFactory
    kind: ethereum/contract
    network: mainnet
    source:
      abi: DAOFactory
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/dao.ts
      entities:
        - Organization
        - EVMScriptRegistry
      abis:
        - name: DAOFactory
          file: ./abis/factory/DAOFactory.json
      eventHandlers:
        - event: DeployDAO(address)
          handler: handleDeployDAO
        - event: DeployEVMScriptRegistry(address)
          handler: handleDeployEVMScriptRegistry
  - name: Kernel
    kind: ethereum/contract
    network: mainnet
    source:
      abi: KernelProxy
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/kernel.ts
      entities:
        - AppInstance
      abis:
        - name: Kernel
          file: ./abis/kernel/Kernel.json
        - name: KernelProxy
          file: ./abis/kernel/KernelProxy.json
      eventHandlers:
        - event: ProxyDeposit(address,uint256)
          handler: handleProxyDeposit
        - event: SetApp(indexed bytes32,indexed bytes32,address)
          handler: handleSetApp
  - name: Repo
    kind: ethereum/contract
    network: mainnet
    source:
      abi: Repo
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      file: ./src/mappings/apm.ts
      entities:
        - PackageVersion
      abis:
        - name: Repo
          file: ./abis/apm/Repo.json
      eventHandlers:
        - event: NewVersion(uint256,uint16[3])
          handler: handleNewVersion
